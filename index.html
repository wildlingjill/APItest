<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript">
      const client_id = "acffd5452e72d99e751f";
      onClick = (event) => {
        // example error message and stacktrace
        let error = `java.lang.NoSuchMethodException: Cannot find 843 getter on class org.pharmgkb.model.Variant at org.pharmgkb.util.ReflectionUtils.findGetMethod(ReflectionUtils.java:125) at org.pharmgkb.web.api.data.AbstractDataResource.getCollection(AbstractDataResource.java:339) at org.pharmgkb.web.api.data.DataResource.getCollection(DataResource.java:147) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161) at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99) at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102) at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) at org.glassfish.jersey.internal.Errors.process(Errors.java:315) at org.glassfish.jersey.internal.Errors.process(Errors.java:297) at org.glassfish.jersey.internal.Errors.process(Errors.java:267) at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317) at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305) at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154) at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473) at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ... at org.pharmgkb.web.common.filters.CognitoServletFilter.doFilterInternal(CognitoServletFilter.java:89) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at org.pharmgkb.web.common.filters.LogFilter.doFilterInternal(LogFilter.java:49) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ... at java.lang.Thread.run(Thread.java:748)java.lang.NoSuchMethodException: Cannot find 843 getter on class org.pharmgkb.model.Variant at org.pharmgkb.util.ReflectionUtils.findGetMethod(ReflectionUtils.java:125) at org.pharmgkb.web.api.data.AbstractDataResource.getCollection(AbstractDataResource.java:339) at org.pharmgkb.web.api.data.DataResource.getCollection(DataResource.java:147) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161) at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99) at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102) at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) at org.glassfish.jersey.internal.Errors.process(Errors.java:315) at org.glassfish.jersey.internal.Errors.process(Errors.java:297) at org.glassfish.jersey.internal.Errors.process(Errors.java:267) at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317) at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305) at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154) at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473) at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ... at org.pharmgkb.web.common.filters.CognitoServletFilter.doFilterInternal(CognitoServletFilter.java:89) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at org.pharmgkb.web.common.filters.LogFilter.doFilterInternal(LogFilter.java:49) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ... at java.lang.Thread.run(Thread.java:749)java.lang.NoSuchMethodException: Cannot find 843 getter on class org.pharmgkb.model.Variant at org.pharmgkb.util.ReflectionUtils.findGetMethod(ReflectionUtils.java:125) at org.pharmgkb.web.api.data.AbstractDataResource.getCollection(AbstractDataResource.java:339) at org.pharmgkb.web.api.data.DataResource.getCollection(DataResource.java:147) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161) at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160) at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99) at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347) at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102) at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) at org.glassfish.jersey.internal.Errors.process(Errors.java:315) at org.glassfish.jersey.internal.Errors.process(Errors.java:297) at org.glassfish.jersey.internal.Errors.process(Errors.java:267) at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317) at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305) at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154) at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473) at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ... at org.pharmgkb.web.common.filters.CognitoServletFilter.doFilterInternal(CognitoServletFilter.java:89) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at org.pharmgkb.web.common.filters.LogFilter.doFilterInternal(LogFilter.java:49) at org.pharmgkb.web.common.filters.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:111) ... at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ... at java.lang.Thread.run(Thread.java:750)`;
        let message = 'something went very wrong oh no';
        // open a child window that calls github for authorization with the app's client id
        // window asks for user to log in to github and authorize the app
        // redirects the child window to /return and sends a postmessage back to this window with the client access token
        let win = window.open(`https://github.com/login/oauth/authorize?scope=repo&client_id=${client_id}`, 'github', 'height=650,width=500');
        // when post message is received, trigger event listener
        window.addEventListener('message', (event) => {
          // if event domain is not same as window domain, do nothing
          if (event.origin !== window.location.origin) {
            return;
          } else {
            // get user access code (used to get access token) and close child window
            let code = event.data.code;
            win.close();
            // post request to my API endpoint, send access code, parent window url and error message/stacktrace
            fetch(`/api/createIssue`, {
              method: 'POST',
              headers: {
                'content-type': 'application/json',
              },
              body: JSON.stringify({
                code,
                original_url: window.location.href,
                message,
                error,
              }),
            })
            .then((response) => {
              return response.json();
            })
            .then((res) => {
              // res contains info about new github issue, can then make a button to send user to issue on github, ask them to fill in more details
              return window.alert(`An issue has been created! See it here: ${res.html_url}`);
            });
          }
        });
      };
    </script>
  </head>
  <body>
    <button onclick="onClick(event)">Create Github issue</button>
  </body>
</html>
